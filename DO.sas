%LET ANO_INICIO = 202208;
%LET ANO_FIM = 202310;


%MACRO CRIA_BASE(INICIO, FIM);
	DO I = &INICIO. TO &FIM.;
		DATA BASE_ANALISE;
			INPUT NOME $ ID CANAL $ SAFRA VALORES_ORIGINAL;
			DATALINES;
			Joao 1 MOBILE &I. 100
			Maria 2 INTERNET &I. 150
			Carlos 3 AGENCIA &I. 200
			Ana 4 MOBILE &I. 120
			Pedro 5 INTERNET &I. 180
			Luis 6 AGENCIA &I. 220
			Fernanda 7 MOBILE &I. 90
			Rafael 8 INTERNET &I. 130
			Julia 9 AGENCIA &I. 190
			Gustavo 10 MOBILE &I. 110
			Camila 11 INTERNET &I. 160
			Marcos 12 AGENCIA &I. 210
			Mariana 13 MOBILE &I. 80
			Diego 14 INTERNET &I. 140
			Isabela 15 AGENCIA &I. 200
			Rodrigo 16 MOBILE &I. 95
			Renata 17 INTERNET &I. 145
			Lucas 18 AGENCIA &I. 205
			Beatriz 19 MOBILE &I. 105
			Thiago 20 INTERNET &I. 170
			;
		RUN;
	END;
%MEND;

%CRIA_BASE(202301, 202310);


DATA DADOS_INPUT;
INPUT ID SAFRA VALORES_PAGO;
DATALINES;
1 202301 50
2 202302 75
3 202303 100
4 202304 60
5 202305 90
6 202306 110
7 202307 45
8 202308 65
9 202309 95
10 202310 55
11 202301 80
12 202302 105
13 202303 40
14 202304 70
15 202305 100
16 202306 48
17 202307 72
18 202308 102
19 202309 52
20 202310 85
;
RUN;


%MACRO EMPILHA_BASES(INICIO, FIM);
	
	DO I = INICIO to FIM;
		PROC SQL;
			CREATE TABLE BASE_ANALISE AS SELECT 	
				SUM(VALORES)/TOTAL
				,A.*
			FROM BASE_ANALISE_&I. AS A
			LEFT JOIN BASE_CARD_&I. AS B ON A.ID = B.ID
			WHERE VALORES > 0
			;
		QUIT;
	END;

%MEND;



DATA TESTE;
	
RUN;

